-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local player = Players.LocalPlayer

-- ðŸ”” Notifier
local function notify(msg)
    StarterGui:SetCore("SendNotification", {
        Title = "Script Notifier",
        Text = msg,
        Duration = 2,
    })
    print(msg)
end

-- Remotes
local remotes = ReplicatedStorage:WaitForChild("remotes")
local onHit = remotes:WaitForChild("onHit")
local abilityHit = remotes:WaitForChild("abilityHit")
local swing = remotes:WaitForChild("swing")
local useBuff = remotes:WaitForChild("useAbility")
local parryRemote = remotes:WaitForChild("parry") -- remote parry

-- ðŸ”¹ Kirim request buff contoh
useBuff:FireServer("LifeSteal1")

-- Variabel Global
_G.active = false
_G.godMode = true
_G.instakill = false
_G.vacuumActive = false
_G.autoParry = false
_G.speedBoost = false
_G.proteksi = true

local damagePerHit = 2
local boostedWalkSpeed = 50
local originalWalkSpeed = 16
local speedJumpPower = 75
local originalJumpPower = 50
local maxHealthValue = math.huge

local vacuumRadius = 100
local vacuumMinDistance = 5
local vacuumSpeed = 0.2
local behindDistance = -5
local heightOffset = 0
local maxDistance = 100
local lerpSpeed = 0.1

local excludedEnemies = {
    ["Blender"] = true,
    ["Dummy"] = true,
}

--------------------------------------------------------
-- ðŸ›  Fungsi Game
--------------------------------------------------------
local function applySpeedBoost()
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    if _G.speedBoost then
        hum.WalkSpeed = boostedWalkSpeed
        hum.JumpPower = speedJumpPower
    else
        hum.WalkSpeed = originalWalkSpeed
        hum.JumpPower = originalJumpPower
    end
end

local function enableGodMode()
    local char = player.Character or player.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    hum.MaxHealth = maxHealthValue
    hum.Health = maxHealthValue
    hum.HealthChanged:Connect(function()
        if _G.godMode and hum.Health < hum.MaxHealth then
            hum.Health = hum.MaxHealth
        end
    end)
end

local function enableAntiKnockback()
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.ChildAdded:Connect(function(child)
        if _G.proteksi and (child:IsA("BodyVelocity") or child:IsA("VectorForce") or child:IsA("LinearVelocity")) then
            child:Destroy()
        end
    end)
end

local function enableAntiStun()
    local char = player.Character or player.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
        if _G.proteksi and hum.WalkSpeed == 0 then
            hum.WalkSpeed = originalWalkSpeed
        end
    end)
    hum:GetPropertyChangedSignal("JumpPower"):Connect(function()
        if _G.proteksi and hum.JumpPower == 0 then
            hum.JumpPower = originalJumpPower
        end
    end)
    char.DescendantAdded:Connect(function(obj)
        if _G.proteksi and obj.Name:lower():find("stun") then
            obj:Destroy()
        end
    end)
    RunService.RenderStepped:Connect(function()
        if _G.proteksi then
            for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
                hum:SetStateEnabled(state, true)
            end
        end
    end)
end

local function getCharacterHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

local function getNearestEnemy()
    local charHRP = getCharacterHRP()
    local nearest, nearestDist
    for _, obj in pairs(Workspace:GetChildren()) do
        local hum = obj:FindFirstChildOfClass("Humanoid")
        local hrp = obj:FindFirstChild("HumanoidRootPart")
        if hum and hrp and hum.Health > 0 and obj ~= player.Character and not excludedEnemies[obj.Name] then
            local dist = (hrp.Position - charHRP.Position).Magnitude
            if not nearest or dist < nearestDist then
                nearest, nearestDist = hrp, dist
            end
        end
    end
    return nearest
end

local function attackTarget(humanoid)
    if not humanoid or humanoid.Health <= 0 then return end
    local damage = _G.instakill and math.huge or damagePerHit
    swing:FireServer()
    task.wait(0.05)
    onHit:FireServer(humanoid, damage)
    abilityHit:FireServer(humanoid, damage, {["burn"]={["dur"]=1}})
end

local function killAll()
    for _,v in pairs(Workspace:GetChildren()) do
        local hum = v:FindFirstChildOfClass("Humanoid")
        local hrp = v:FindFirstChild("HumanoidRootPart")
        if hum and hrp and hum.Health > 0 and v ~= player.Character and not excludedEnemies[v.Name] then
            attackTarget(hum)
        end
    end
end

--------------------------------------------------------
-- ðŸš€ RenderStepped Loops
--------------------------------------------------------
RunService.RenderStepped:Connect(function()
    -- Auto Nempel
    if _G.active then
        local charHRP = getCharacterHRP()
        local enemyHRP = getNearestEnemy()
        if charHRP and enemyHRP then
            local enemyLook = enemyHRP.CFrame.LookVector
            local targetPos = enemyHRP.Position + (enemyLook * behindDistance) + Vector3.new(0,heightOffset,0)
            local distance = (targetPos - charHRP.Position).Magnitude
            if distance <= maxDistance then
                local newPos = charHRP.Position:Lerp(targetPos, lerpSpeed)
                charHRP.CFrame = CFrame.new(newPos.X,charHRP.Position.Y,newPos.Z,enemyHRP.Position.X,charHRP.Position.Y,enemyHRP.Position.Z)
            end
        end
    end

    -- Mob Vacuum
    if _G.vacuumActive then
        local charHRP = getCharacterHRP()
        for _, obj in pairs(Workspace:GetChildren()) do
            local hum = obj:FindFirstChildOfClass("Humanoid")
            local hrp = obj:FindFirstChild("HumanoidRootPart")
            if hum and hrp and hum.Health>0 and obj ~= player.Character and not excludedEnemies[obj.Name] then
                local dist = (hrp.Position - charHRP.Position).Magnitude
                if dist <= vacuumRadius and dist > vacuumMinDistance then
                    local newPos = hrp.Position:Lerp(charHRP.Position, vacuumSpeed)
                    hrp.CFrame = CFrame.new(newPos.X,charHRP.Position.Y,newPos.Z)
                    hum.AutoRotate = false
                end
            end
        end
    end

    -- Auto Parry
    if _G.autoParry then
        pcall(function() parryRemote:FireServer() end)
    end
end)

--------------------------------------------------------
-- ðŸ“Œ Saat Spawn
--------------------------------------------------------
local function setupCharacter()
    local char = player.Character or player.CharacterAdded:Wait()
    applySpeedBoost()
    if _G.godMode then enableGodMode() end
    enableAntiKnockback()
    enableAntiStun()
end

player.CharacterAdded:Connect(setupCharacter)
if player.Character then setupCharacter() end

--------------------------------------------------------
-- ðŸ“¦ UI
--------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)

-- (Gunakan UI draggable + hide/show + toggle + slider dari script sebelumnya)
-- untuk menghemat panjang, saya akan gabungkan bagian UI final yang sudah kita buat sebelumnya
-- termasuk: toggle semua fitur, tombol KillAll, slider SpeedBoost, dan toggle menu

-- â€¦ (UI final dari script sebelumnya) â€¦

notify("âœ… Script siap. UI siap dan fitur semua aktif. Drag menu sesuka hati. âš¡")
