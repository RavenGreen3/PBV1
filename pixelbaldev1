-- LocalScript untuk Mobile
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer

-- Remotes
local remotes = ReplicatedStorage:WaitForChild("remotes")
local onHit = remotes:WaitForChild("onHit")
local abilityHit = remotes:WaitForChild("abilityHit")
local swing = remotes:WaitForChild("swing")
local useBuff = remotes:WaitForChild("useAbility")
local parryRemote = remotes:WaitForChild("parry")

-- Buff
useBuff:FireServer("LifeSteal1")

-- Pengaturan
local active, instakill, vacuumActive, speedBoost, autoParry = false, false, false, false, false
local damagePerHit = 2
local boostedWalkSpeed = 50
local originalWalkSpeed = 16
local speedJumpPower = 75
local originalJumpPower = 50
local behindDistance = -5
local heightOffset = 0
local maxDistance = 100
local lerpSpeed = 0.1
local godMode = true
local maxHealthValue = math.huge
local antiKnockback, antiStun = true, true
local excludedEnemies = {["Blender"]=true, ["Dummy"]=true}

-- GUI Setup (ScreenGui)
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- Frame Menu
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,200,0,350)
frame.Position = UDim2.new(0,200,0,100)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active = true
frame.Draggable = true
frame.Visible = false
frame.Parent = screenGui

-- Tombol Show/Hide
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0,120,0,40)
toggleBtn.Position = UDim2.new(0,20,0,20)
toggleBtn.Text = "Show/Hide Menu"
toggleBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Parent = screenGui

toggleBtn.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
end)

-- Fungsi buat bikin tombol dalam Frame
local function createButton(name, posY, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,150,0,40)
    btn.Position = UDim2.new(0,25,0,posY)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Parent = frame
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Buttons (isi menu)
createButton("Auto Nempel", 20, function() active = not active end)
createButton("Instakill", 70, function() instakill = not instakill end)
createButton("Mob Vacuum", 120, function() vacuumActive = not vacuumActive end)
createButton("Speed Boost", 170, function() 
    speedBoost = not speedBoost
    local char = player.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then
            if speedBoost then
                hum.WalkSpeed = boostedWalkSpeed
                hum.JumpPower = speedJumpPower
            else
                hum.WalkSpeed = originalWalkSpeed
                hum.JumpPower = originalJumpPower
            end
        end
    end
end)
createButton("Auto Parry", 220, function() autoParry = not autoParry end)
createButton("Proteksi", 270, function() 
    antiKnockback = not antiKnockback
    antiStun = not antiStun 
end)

-- Helper functions
local function getCharacterHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

local function getNearestEnemy()
    local charHRP = getCharacterHRP()
    local nearest, nearestDist
    for _, obj in pairs(Workspace:GetChildren()) do
        local hum = obj:FindFirstChildOfClass("Humanoid")
        local hrp = obj:FindFirstChild("HumanoidRootPart")
        if hum and hrp and hum.Health > 0 and obj ~= player.Character and not excludedEnemies[obj.Name] then
            local dist = (hrp.Position - charHRP.Position).Magnitude
            if not nearest or dist < nearestDist then
                nearest, nearestDist = hrp, dist
            end
        end
    end
    return nearest
end

local function attackTarget(humanoid)
    if not humanoid or humanoid.Health <= 0 then return end
    local damage = instakill and math.huge or damagePerHit
    swing:FireServer()
    task.wait(0.05)
    onHit:FireServer(humanoid, damage)
    abilityHit:FireServer(humanoid, damage, {["burn"]={["dur"]=1}})
end

local function killAll()
    for _,v in pairs(Workspace:GetChildren()) do
        local hum = v:FindFirstChildOfClass("Humanoid")
        local hrp = v:FindFirstChild("HumanoidRootPart")
        if hum and hrp and hum.Health > 0 and v ~= player.Character and not excludedEnemies[v.Name] then
            attackTarget(hum)
        end
    end
end

-- Main loops
RunService.RenderStepped:Connect(function()
    local charHRP = getCharacterHRP()
    
    -- Auto Nempel
    if active then
        local enemyHRP = getNearestEnemy()
        if enemyHRP then
            local targetPos = enemyHRP.Position + (enemyHRP.CFrame.LookVector * behindDistance) + Vector3.new(0,heightOffset,0)
            local newPos = charHRP.Position:Lerp(targetPos, lerpSpeed)
            charHRP.CFrame = CFrame.new(newPos, Vector3.new(enemyHRP.Position.X,newPos.Y,enemyHRP.Position.Z))
        end
    end
    
    -- Mob Vacuum
    if vacuumActive then
        for _, obj in pairs(Workspace:GetChildren()) do
            local hum = obj:FindFirstChildOfClass("Humanoid")
            local hrp = obj:FindFirstChild("HumanoidRootPart")
            if hum and hrp and hum.Health > 0 and obj ~= player.Character and not excludedEnemies[obj.Name] then
                local dist = (hrp.Position - charHRP.Position).Magnitude
                if dist <= 100 and dist > 5 then
                    local newPos = hrp.Position:Lerp(charHRP.Position, 0.2)
                    hrp.CFrame = CFrame.new(newPos.X,charHRP.Position.Y,newPos.Z)
                    hum.AutoRotate = false
                end
            end
        end
    end
    
    -- Auto Parry
    if autoParry then
        pcall(function() parryRemote:FireServer() end)
    end
end)

-- Enable GodMode, AntiKnockback, AntiStun
player.CharacterAdded:Connect(function()
    task.wait(1)
    if godMode then
        local hum = player.Character:WaitForChild("Humanoid")
        hum.MaxHealth = maxHealthValue
        hum.Health = maxHealthValue
        hum.HealthChanged:Connect(function()
            if hum.Health < hum.MaxHealth then hum.Health = hum.MaxHealth end
        end)
    end
end)
